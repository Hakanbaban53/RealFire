"use strict";import{XPCOMUtils}from"resource://gre/modules/XPCOMUtils.sys.mjs";const lazy={};XPCOMUtils.defineLazyModuleGetters(lazy,{SelectionUtils:"resource://gre/modules/SelectionUtils.jsm",E10SUtils:"resource://gre/modules/E10SUtils.jsm",WebNavigationFrames:"resource://gre/modules/WebNavigationFrames.jsm"});export class SearchSelectionShortcutChild extends JSWindowActorChild{get keycode(){return this.sendQuery("SearchSelectionShortcut:Keycode")}get matchEngineToTab(){return this.sendQuery("SearchSelectionShortcut:MatchEngineToTab")}async getKeyState(e){if(e.code!==await this.keycode||e.repeat)return false;const alt=e.getModifierState("Alt");const shift=e.getModifierState("Shift");if(e.getModifierState("Accel")){if(await this.matchEngineToTab&&!shift&&alt)return"match";if(shift&&!alt)return"default"}return false}async handleEvent(e){let match=false;switch(await this.getKeyState(e)){case"default":break;case"match":match=true;break;default:return}const doc=e.composedTarget.ownerDocument,selection=lazy.SelectionUtils.getSelectionDetails(this.contentWindow,8192);if(!selection?.text||selection?.docSelectionIsCollapsed)return;this.sendAsyncMessage("SearchSelectionShortcut:Keydown",{csp:lazy.E10SUtils.serializeCSP(doc.csp),referrerInfo:lazy.E10SUtils.serializeReferrerInfo(doc.referrerInfo),text:selection.text,locationURL:this.contentWindow.location.href,locationHost:this.contentWindow.location.hostname,frameID:lazy.WebNavigationFrames.getFrameId(doc.defaultView),match});e.stopPropagation();e.stopImmediatePropagation();e.preventDefault()}}